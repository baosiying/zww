define(["JC.Panel","JC.Dialog","util","zlang.dialog.login"],function(e,n,o,t){var i,l,r,a={},s=document,d=".send-flower-btn",u=!1;return a.init=function(){JC.Panel.clickClose=!1,a.genFlowerDiv(),a.bindAct()},a.bindAct=function(){$(s).on("click",d,function(){var e=$(this);r=$(this).attr("data-api"),a.sendFlowerQuest(e)})},a.sendFlowerQuest=function(e){if(!u){var n=e;Zlib.tool.ajax(r).done(function(e){var e=o.io.parseJson(e);if(e.code<=0)-400==e.code?t.show():e.tmp?(a.sendResultPop(e.tmp),n.removeAttr("disabled").removeClass("disabled")):e.msg&&o.ui.showFail(e.msg,n,function(){n.removeAttr("disabled").removeClass("disabled")});else{var i=e.msg||"鲜花赠送成功，谢谢支持！";o.ui.showSucc(i);var l=$("#flower-num");if(!l.length)return;var r=1,s=1*l.text();if(30>=s)return void l.text(s+r);var d=s,u=s+r,c=600,f=10,v=Math.floor(r/(c/f)),m=null;return void(m=setInterval(function(){var e=r>100?v+Math.floor(10*Math.random()):1;d+=e;var n=Math.min(u,d);l.text(n),n>=u&&clearInterval(m)},f))}}).fail(function(){o.ui.showFail("操作失败，请稍后重试"),n.removeAttr("disabled").removeClass("disabled")})}},a.genFlowerDiv=function(){return $('<div id="flyFlower" class="flyFlower"><i></i></div>').appendTo($("body")),i=$("#flyFlower")},a.sendResultPop=function(e){return l=JC.Dialog(e)},a});